# Generated by Anaconda 34.25.5.17
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
graphical
# Reboot after installation
reboot
repo --name="AppStream" --baseurl={{ mirror.protocol }}://{{ mirror.host }}/{{ os.distro }}/{{ os.version }}/{{ os.appstream }}/{{ os.arch }}/os

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=enp1s0 --ipv6=auto --activate
network  --hostname={{ host.name }}

# Use network installation
url --url="{{ mirror.protocol }}://{{ mirror.host }}/{{ os.distro }}/{{ os.version }}/{{ os.baseos }}/{{ os.arch }}/os"

%packages
@^server-product-environment
@remote-system-management

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=sdb
# Partition clearing information
clearpart --none --initlabel
# Disk partitioning information
part / --fstype="xfs" --ondisk=sdb --size=183385
part /home --fstype="xfs" --ondisk=sdb --size=51200
part /boot/efi --fstype="efi" --ondisk=sdb --size=600 --fsoptions="umask=0077,shortname=winnt"
part /boot --fstype="xfs" --ondisk=sdb --size=1024
part swap --fstype="swap" --ondisk=sdb --size=7988

# System timezone
timezone America/Denver --utc

#Root password
rootpw --lock
{%- for user in users %}
user --groups=wheel --name={{ user.name }}  --iscrypted --lock --gecos="{{ user.full_name }}"
sshkey --username={{ user.name }} 
{%- endfor %}

%post
echo -e "%wheel\tALL=(ALL)\tNOPASSWD: ALL">/etc/sudoers.d/wheelers
tee /etc/systemd/sleep.conf << EOF
#  This file is part of systemd.
#
#  systemd is free software; you can redistribute it and/or modify it under the
#  terms of the GNU Lesser General Public License as published by the Free
#  Software Foundation; either version 2.1 of the License, or (at your option)
#  any later version.
#
# Entries in this file show the compile time defaults. Local configuration
# should be created by either modifying this file, or by creating "drop-ins" in
# the sleep.conf.d/ subdirectory. The latter is generally recommended.
# Defaults can be restored by simply deleting this file and all drop-ins.
#
# See systemd-sleep.conf(5) for details.

[Sleep]
AllowSuspend=no
AllowHibernation=no
AllowSuspendThenHibernate=no
AllowHybridSleep=no
#SuspendMode=
#SuspendState=mem standby freeze
#HibernateMode=platform shutdown
#HibernateState=disk
#HybridSleepMode=suspend platform shutdown
#HybridSleepState=disk
#HibernateDelaySec=
#SuspendEstimationSec=60min
EOF
%end
