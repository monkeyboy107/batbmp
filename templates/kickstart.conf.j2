# Generated by Anaconda 34.25.5.17
# Generated by pykickstart v3.32
#version=RHEL9
# Use graphical install
graphical
# Reboot after installation
reboot
repo --name="AppStream" --baseurl={{ mirror.protocol }}://{{ mirror.host }}/{{ os.distro }}/{{ os.version }}/{{ os.appstream }}/{{ os.arch }}/os

%post
{%- for user in users %}
mkdir /home/{{ user.name }}/.ssh
chown {{ user.name }}: /home/{{ user.name }}/.ssh
echo {{ user.ssh_public_key }}>/home/{{ user.name }}/.ssh/authorized_keys
chmod kerley: -R 600 /home/{{ user.name }}/.ssh
echo -e "%wheel\tALL=(ALL)\tNOPASSWD: ALL">/etc/sudoers.d/wheelers
{%- endfor %}
%end

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=enp1s0 --ipv6=auto --activate
network  --hostname={{ host.name }}

# Use network installation
url --url="{{ mirror.protocol }}://{{ mirror.host }}/{{ os.distro }}/{{ os.version }}/{{ os.baseos }}/{{ os.arch }}/os"

%packages
@^server-product-environment
@remote-system-management

%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.6.0
ignoredisk --only-use=sdb,sda
autopart
# Partition clearing information
clearpart --none --initlabel

# System timezone
timezone America/Denver --utc

#Root password
rootpw --lock
{%- for users in user %}
user --groups=wheel --name={{ user.name }}  --iscrypted --lock --gecos="{{ user.full_name }}"
{%- endfor %}
